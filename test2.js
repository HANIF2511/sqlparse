JSONdata = [{
 "kind": "drive#fileList",
 "incompleteSearch": false,
 "files": [
  {
   "kind": "drive#file",
   "id": "144du8TIxbtEsGzcgWK7TIgstNg6ZTIOM",
   "name": "Sub1Folder",
   "mimeType": "application/vnd.google-apps.folder",
   "starred": false,
   "trashed": false,
   "explicitlyTrashed": false,
   "parents": [
    "1crHS8KPx63qTWnI3bQLeQnzCwtem6dZw"
   ],
   "spaces": [
    "drive"
   ],
   "version": "1",
   "webViewLink": "https://drive.google.com/drive/folders/144du8TIxbtEsGzcgWK7TIgstNg6ZTIOM",
   "iconLink": "https://drive-thirdparty.googleusercontent.com/16/type/application/vnd.google-apps.folder",
   "hasThumbnail": false,
   "thumbnailVersion": "0",
   "viewedByMe": true,
   "viewedByMeTime": "2020-11-04T14:23:47.386Z",
   "createdTime": "2020-11-04T14:23:47.386Z",
   "modifiedTime": "2020-11-04T14:23:47.386Z",
   "modifiedByMeTime": "2020-11-04T14:23:47.386Z",
   "modifiedByMe": true,
   "owners": [
    {
     "kind": "drive#user",
     "displayName": "Fuad Kamal",
     "me": true,
     "permissionId": "11483117422544301204",
     "emailAddress": "fuadks@fuaddomain.com"
    }
   ],
   "lastModifyingUser": {
    "kind": "drive#user",
    "displayName": "Fuad Kamal",
    "me": true,
    "permissionId": "11483117422544301204",
    "emailAddress": "fuadks@fuaddomain.com"
   },
   "shared": false,
   "ownedByMe": true,
   "capabilities": {
    "canAddChildren": true,
    "canAddMyDriveParent": false,
    "canChangeCopyRequiresWriterPermission": false,
    "canChangeViewersCanCopyContent": false,
    "canComment": true,
    "canCopy": false,
    "canDelete": true,
    "canDownload": true,
    "canEdit": true,
    "canListChildren": true,
    "canModifyContent": true,
    "canMoveChildrenWithinDrive": true,
    "canMoveItemIntoTeamDrive": true,
    "canMoveItemOutOfDrive": true,
    "canMoveItemWithinDrive": true,
    "canReadRevisions": false,
    "canRemoveChildren": true,
    "canRemoveMyDriveParent": true,
    "canRename": true,
    "canShare": true,
    "canTrash": true,
    "canUntrash": true
   },
   "viewersCanCopyContent": true,
   "copyRequiresWriterPermission": false,
   "writersCanShare": true,
   "permissions": [
    {
     "kind": "drive#permission",
     "id": "11483117422544301204",
     "type": "user",
     "emailAddress": "fuadks@fuaddomain.com",
     "role": "owner",
     "displayName": "Fuad Kamal",
     "deleted": false
    }
   ],
   "permissionIds": [
    "11483117422544301204"
   ],
   "folderColorRgb": "#8f8f8f",
   "quotaBytesUsed": "0",
   "isAppAuthorized": false
  },
  {
   "kind": "drive#file",
   "id": "0BwIow2M91P7tc3RhcnRlcl9maWxlX2Rhc2hlclYw",
   "name": "Getting started",
   "mimeType": "application/pdf",
   "starred": false,
   "trashed": false,
   "explicitlyTrashed": false,
   "parents": [
    "1crHS8KPx63qTWnI3bQLeQnzCwtem6dZw"
   ],
   "spaces": [
    "drive"
   ],
   "version": "2",
   "webContentLink": "https://drive.google.com/uc?id=0BwIow2M91P7tc3RhcnRlcl9maWxlX2Rhc2hlclYw&export=download",
   "webViewLink": "https://drive.google.com/file/d/0BwIow2M91P7tc3RhcnRlcl9maWxlX2Rhc2hlclYw/view?usp=drivesdk",
   "iconLink": "https://drive-thirdparty.googleusercontent.com/16/type/application/pdf",
   "hasThumbnail": true,
   "thumbnailLink": "https://lh3.googleusercontent.com/kVaAG-uTTwwt8f7QgDNe5QI-VXfcBUy_6fay5gwRV1uukD4wC5pQWtfDkH2kO0ZzrihIwDyRFeGxeSnkB1JjVzw=s220",
   "thumbnailVersion": "1",
   "viewedByMe": false,
   "createdTime": "2019-12-21T17:50:48.292Z",
   "modifiedTime": "2019-12-21T17:50:48.292Z",
   "modifiedByMe": false,
   "owners": [
    {
     "kind": "drive#user",
     "displayName": "Fuad Kamal",
     "me": true,
     "permissionId": "11483117422544301204",
     "emailAddress": "fuadks@fuaddomain.com"
    }
   ],
   "lastModifyingUser": {
    "kind": "drive#user",
    "displayName": "Fuad Kamal",
    "me": true,
    "permissionId": "11483117422544301204",
    "emailAddress": "fuadks@fuaddomain.com"
   },
   "shared": false,
   "ownedByMe": true,
   "capabilities": {
    "canAddChildren": false,
    "canAddMyDriveParent": false,
    "canChangeCopyRequiresWriterPermission": true,
    "canChangeViewersCanCopyContent": true,
    "canComment": true,
    "canCopy": true,
    "canDelete": true,
    "canDownload": true,
    "canEdit": true,
    "canListChildren": false,
    "canModifyContent": true,
    "canMoveChildrenWithinDrive": false,
    "canMoveItemIntoTeamDrive": true,
    "canMoveItemOutOfDrive": true,
    "canMoveItemWithinDrive": true,
    "canReadRevisions": true,
    "canRemoveChildren": false,
    "canRemoveMyDriveParent": true,
    "canRename": true,
    "canShare": true,
    "canTrash": true,
    "canUntrash": true
   },
   "viewersCanCopyContent": true,
   "copyRequiresWriterPermission": false,
   "writersCanShare": true,
   "permissions": [
    {
     "kind": "drive#permission",
     "id": "11483117422544301204",
     "type": "user",
     "emailAddress": "fuadks@fuaddomain.com",
     "role": "owner",
     "displayName": "Fuad Kamal",
     "deleted": false
    }
   ],
   "permissionIds": [
    "11483117422544301204"
   ],
   "originalFilename": "Getting started",
   "fullFileExtension": "",
   "fileExtension": "",
   "md5Checksum": "ff8aefae1178dce941c9de267b4184de",
   "size": "696774",
   "quotaBytesUsed": "0",
   "headRevisionId": "0BwIow2M91P7tek5LMitUQmhGTUFlN3lDL1N1MERmUWZnYWM0PQ",
   "isAppAuthorized": false
  }
 ]
}
];
function buildDocsFromGoogleList(searchRecord, foldeName)
{
	var MyDocuments = "My+Documents";
	console.log("searchRecord:", searchRecord);
	var dataFormatted ={};
	dataFormatted.id = MyDocuments + "." + foldeName + ";" + searchRecord.id
	dataFormatted.name = searchRecord.name;
	dataFormatted.starred = searchRecord.starred;
	dataFormatted.shared = searchRecord.shared;

	var mimeType = searchRecord.mimeType;
	var array = mimeType.split("/");
	var ext = array[1];
	dataFormatted.ext = ext;

	dataFormatted.type = "0";

	var  size = searchRecord.size;
	//size = ConvertSize(size);
	dataFormatted.size = size;
	
	
	return dataFormatted; 
}
function testFormat()
{
   var newData = [];
   var data = JSONdata[0].files;
   var foldeName = "TM1";
	for (var i=0; i< data.length; i++)
	{
		var dataFormatted = buildDocsFromGoogleList (data[i], foldeName);
		newData.push(dataFormatted);
	}
console.log ('datareceived:newData:' , JSON.stringify(newData) );
}

//testFormat();

		function storeRulesPtrs(rules, rulesDef)
		{
			var currentQUERY_DEF = "";
			var currentRULE_ID = "";
			var rulePtrs =[];

			for (var i=0; i<rules.length; i++)
			{
				console.log(rules[i].QUERY_DEF + " : " + rules[i].RULE_ID + "          " + currentQUERY_DEF + " : " + currentRULE_ID);
				if ( ( currentQUERY_DEF != rules[i].QUERY_DEF ) && ( currentRULE_ID != rules[i].RULE_ID ) )
				{
					console.log(" not equal");
					rulePtrs.push(i);
					if (currentQUERY_DEF != "")
					{
						console.log("--storing rulePtrs2:",rulePtrs);
						rulesDef.rulePtrsArr[currentQUERY_DEF] = rulePtrs;
						rulePtrs = [];
						rulePtrs.push(i);
					}
					
					currentQUERY_DEF = rules[i].QUERY_DEF ;
					currentRULE_ID = rules[i].RULE_ID ;
					//console.log("rulePtrs1:",rulePtrs);

				}
				else if ( ( currentQUERY_DEF == rules[i].QUERY_DEF ) && ( currentRULE_ID != rules[i].RULE_ID ) )
				{
					console.log(" not equal2");
					currentRULE_ID = rules[i].RULE_ID ;
					rulePtrs.push(i);
					console.log("rulePtrs2:",rulePtrs);
				}
				console.log("rulePtrs2:",rulePtrs);
			}
			rulePtrs.push(i);
			rulesDef.rulePtrsArr[currentQUERY_DEF] = rulePtrs;
			console.log("rulesDef.rulePtrsArr:",rulesDef.rulePtrsArr);
		}


var rulesPostQueryDef = {
    rulePtrsArr:[],
    rulesArr : [],
    actionPtrsArr : [],
    actionsArr : []
  };
var rules = [
{"MODULE":"PROVISION","RULE_ID":6,"QUERY_DEF":"GET_DSP_WORK_ORDERS_BY_ORDER_NO","RULE_KEY":"ORDER_NO","RESPONSE_DATA_ID":"data.data","RESPONSE_DATA_NAME":"responseData","ROUTINE":"DSPEKYC","ITEM":1,"FIELD":"ASSIGNEE_TYPE","OPERATION":"=","FIELD_VALUE":"FORM","_QUERY":"GET_ADM_RULE_DEF_RULE_ITEM"},
{"MODULE":"PROVISION","RULE_ID":6,"QUERY_DEF":"GET_DSP_WORK_ORDERS_BY_ORDER_NO","RULE_KEY":"ORDER_NO","RESPONSE_DATA_ID":"data.data","RESPONSE_DATA_NAME":"responseData","ROUTINE":"DSPEKYC","ITEM":2,"FIELD":"WO_STATUS","OPERATION":"=","FIELD_VALUE":"10","_QUERY":"GET_ADM_RULE_DEF_RULE_ITEM"},
{"MODULE":"PROVISION","RULE_ID":6,"QUERY_DEF":"GET_DSP_WORK_ORDERS_BY_ORDER_NO","RULE_KEY":"ORDER_NO","RESPONSE_DATA_ID":"data.data","RESPONSE_DATA_NAME":"responseData","ROUTINE":"DSPEKYC","ITEM":3,"FIELD":"TEMPLATE_ORDER","OPERATION":"=","FIELD_VALUE":"1","_QUERY":"GET_ADM_RULE_DEF_RULE_ITEM"},

{"MODULE":"PROVISION","RULE_ID":7,"QUERY_DEF":"GET_DSP_WORK_ORDERS_QUERY","RULE_KEY":"WO_ORDER_NO","RESPONSE_DATA_ID":"data.data","RESPONSE_DATA_NAME":"responseData","ROUTINE":"PRVORDERE","ITEM":1,"FIELD":"ASSIGNEE_TYPE","OPERATION":"=","FIELD_VALUE":"FORM","_QUERY":"GET_ADM_RULE_DEF_RULE_ITEM"},
{"MODULE":"PROVISION","RULE_ID":7,"QUERY_DEF":"GET_DSP_WORK_ORDERS_QUERY","RULE_KEY":"WO_ORDER_NO","RESPONSE_DATA_ID":"data.data","RESPONSE_DATA_NAME":"responseData","ROUTINE":"PRVORDERE","ITEM":2,"FIELD":"WO_STATUS","OPERATION":"=","FIELD_VALUE":"10","_QUERY":"GET_ADM_RULE_DEF_RULE_ITEM"},
{"MODULE":"PROVISION","RULE_ID":7,"QUERY_DEF":"GET_DSP_WORK_ORDERS_QUERY","RULE_KEY":"WO_ORDER_NO","RESPONSE_DATA_ID":"data.data","RESPONSE_DATA_NAME":"responseData","ROUTINE":"PRVORDERE","ITEM":3,"FIELD":"TEMPLATE_ORDER","OPERATION":"=","FIELD_VALUE":"1","_QUERY":"GET_ADM_RULE_DEF_RULE_ITEM"},

{"MODULE":"PROVISION","RULE_ID":8,"QUERY_DEF":"GET_DSP_WORK_ORDERS_QUERY","RULE_KEY":"WO_ORDER_NO","RESPONSE_DATA_ID":"data.data","RESPONSE_DATA_NAME":"responseData","ROUTINE":"PRVORDERE","ITEM":1,"FIELD":"ASSIGNEE_TYPE","OPERATION":"=","FIELD_VALUE":"FORM","_QUERY":"GET_ADM_RULE_DEF_RULE_ITEM"},
{"MODULE":"PROVISION","RULE_ID":8,"QUERY_DEF":"GET_DSP_WORK_ORDERS_QUERY","RULE_KEY":"WO_ORDER_NO","RESPONSE_DATA_ID":"data.data","RESPONSE_DATA_NAME":"responseData","ROUTINE":"PRVORDERE","ITEM":2,"FIELD":"WO_STATUS","OPERATION":"=","FIELD_VALUE":"10","_QUERY":"GET_ADM_RULE_DEF_RULE_ITEM"},
{"MODULE":"PROVISION","RULE_ID":8,"QUERY_DEF":"GET_DSP_WORK_ORDERS_QUERY","RULE_KEY":"WO_ORDER_NO","RESPONSE_DATA_ID":"data.data","RESPONSE_DATA_NAME":"responseData","ROUTINE":"PRVORDERE","ITEM":3,"FIELD":"TEMPLATE_ORDER","OPERATION":"=","FIELD_VALUE":"1","_QUERY":"GET_ADM_RULE_DEF_RULE_ITEM"}

];
storeRulesPtrs(rules, rulesPostQueryDef);
